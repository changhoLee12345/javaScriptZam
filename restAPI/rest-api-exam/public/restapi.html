<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h3>Hello</h3>
    <table>
        <tr>
            <th>아이디</th>
            <td><input type="text" id="id"></td>
        </tr>
        <tr>
            <th>content</th>
            <td><input type="text" id="content"></td>
        </tr>
        <tr>
            <th>complted</th>
            <td><input type="text" id="completed"></td>
        </tr>
    </table>
    <button id="post">POST</button>

    <div id="show"></div>

    <script>
        document.getElementById('post').addEventListener('click', deleteJSON);


        function postJSON() {

            var id = document.getElementById('id').value;
            var content = document.getElementById('content').value;
            var completed = document.getElementById('completed').value;

            const xhr = new XMLHttpRequest();
            xhr.open('POST', 'http://localhost:5501/todos');
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.send(JSON.stringify({
                id: id,
                content: content,
                completed: completed
            }));

            xhr.onreadystatechange = function (e) {
                if (xhr.readyState !== XMLHttpRequest.DONE) return;

                if (xhr.status === 201) { // 201: Created
                    console.log(xhr.responseText);
                } else {
                    console.log("Error!");
                }
            }
        };

        function putJSON() {

            var id = document.getElementById('id').value;
            var content = document.getElementById('content').value;
            var completed = document.getElementById('completed').value;

            const xhr = new XMLHttpRequest();
            xhr.open('PUT', 'http://localhost:5501/todos/4');
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.send(JSON.stringify({
                id: id,
                content: content,
                completed: completed
            }));

            xhr.onreadystatechange = function (e) {
                if (xhr.readyState !== XMLHttpRequest.DONE) return;

                if (xhr.status === 200) {
                    console.log(xhr.responseText);
                } else {
                    console.log("Error!");
                }
            };

        }

        function patchJSON() {

            var id = document.getElementById('id').value;
            var content = document.getElementById('content').value;
            var completed = document.getElementById('completed').value;

            const xhr = new XMLHttpRequest();
            xhr.open('PATCH', 'http://localhost:5501/todos/4');
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.send(JSON.stringify({
                completed: true
            }));

            xhr.onreadystatechange = function (e) {
                if (xhr.readyState !== XMLHttpRequest.DONE) return;

                if (xhr.status === 200) {
                    console.log(xhr.responseText);
                } else {
                    console.log("Error!");
                }
            };
        }

        function deleteJSON() {
            const xhr = new XMLHttpRequest();
            xhr.open('DELETE', 'http://localhost:5501/todos/5');
            xhr.send();

            xhr.onreadystatechange = function (e) {
                if (xhr.readyState !== XMLHttpRequest.DONE) return;

                if (xhr.status === 200) {
                    console.log(xhr.responseText);
                } else {
                    console.log("Error!");
                }
            };
        }

        function getJSON() {

            fetch('http://localhost:5501/todos')
                .then(response => response.json())
                .then(result => {
                    console.log(result);
                    let table = document.createElement('table');
                    let tbody = document.createElement('tbody');
                    for (let row of result) {
                        let tr = document.createElement('tr');
                        for (let field in row) {
                            let td = document.createElement('td');
                            td.innerHTML = row[field];
                            tr.appendChild(td);
                        }
                        tbody.appendChild(tr);
                    }
                    table.appendChild(tbody);
                    document.getElementById('show').appendChild(table);
                })
                .catch(error => console.log(error))
        }
        getJSON();
    </script>
</body>

</html>